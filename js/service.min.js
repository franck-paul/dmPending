"use strict";dotclear.ready(()=>{dotclear.dmPending=dotclear.getData("dm_pending");const e=e=>{dotclear.services("dmPendingPostsCount",n=>{try{const o=JSON.parse(n);if(!o?.success)return void console.log(dotclear.debug&&o?.message?o.message:"Dotclear REST server error");if(o?.payload.ret){const{msg:n}=o.payload;if(void 0!==n&&n!==dotclear.dmPending.postsCounter){const t=e.getAttribute("href"),s=(t.includes("?")?"&":"?")+"status=-2",c=`${t}${s}`,d=document.querySelector(`#dashboard-main #icons p a[href="${c}"]`);if(d){const e=d.querySelector("span.db-icon-title-dm-pending");e&&(e.textContent=n)}else if(""!==n&&e.length){const o=` <a href="${c}"><span class="db-icon-title-dm-pending">${n}</span></a>`;e.insertAdjacentHTML("afterEnd",o)}const{nb:a}=o.payload;dotclear.badge(document.querySelector("#pending-posts"),{id:"dmpp",value:a,remove:a<=0,type:"soft"}),dotclear.dmPending.postsCounter=n}}}catch(e){console.log(e)}},e=>{console.log(e)},!0,{json:1})},n=e=>{dotclear.services("dmPendingCommentsCount",n=>{try{const o=JSON.parse(n);if(!o?.success)return void console.log(dotclear.debug&&o?.message?o.message:"Dotclear REST server error");if(o?.payload.ret){const{msg:n}=o.payload;if(void 0!==n&&n!==dotclear.dmPending.commentsCounter){const t=e.getAttribute("href"),s=(t.includes("?")?"&":"?")+"status=-1",c=`${t}${s}`,d=document.querySelector(`#dashboard-main #icons p a[href="${c}"]`);if(d){const e=d.querySelector("span.db-icon-title-dm-pending");e&&(e.textContent=n)}else if(""!==n){const o=` <a href="${c}"><span class="db-icon-title-dm-pending">${n}</span></a>`;e.insertAdjacentHTML("afterEnd",o)}const{nb:a}=o.payload;dotclear.badge(document.querySelector("#pending-comments"),{id:"dmpc",value:a,remove:a<=0,type:"soft"}),dotclear.dmPending.commentsCounter=n}}}catch(e){console.log(e)}},e=>{console.log(e)},!0,{json:1})};dotclear.expandContent({lines:document.querySelectorAll("#pending-posts li.line"),callback:(e,n="toggle",o=null)=>{dotclear.dmViewPost(e,"dmppe",o.metaKey)}});for(const e of document.querySelectorAll("#pending-posts ul"))e.classList.add("expandable");dotclear.expandContent({lines:document.querySelectorAll("#pending-comments li.line"),callback:(e,n="toggle",o=null)=>{dotclear.dmViewComment(e,"dmpce",o.metaKey||e.classList.contains("sts-junk"))}});for(const e of document.querySelectorAll("#pending-comments ul"))e.classList.add("expandable");dotclear.dmPending.autoRefresh&&(dotclear.dmPending.postsCounter&&(icon_posts=document.querySelector("#dashboard-main #icons p #icon-process-posts-fav"),icon_posts&&(e(icon_posts),dotclear.dmPending.postsTimer=setInterval(e,1e3*(dotclear.dmPending.interval||60),icon_posts))),dotclear.dmPending.commentsCounter&&(icon_comments=document.querySelector("#dashboard-main #icons p #icon-process-comments-fav"),icon_comments&&(n(icon_comments),dotclear.dmPending.commentsTimer=setInterval(n,1e3*(dotclear.dmPending.interval||60),icon_comments))))});
