"use strict";dotclear.ready((()=>{dotclear.dmPending=dotclear.getData("dm_pending");const e=e=>{dotclear.services("dmPendingPostsCount",(t=>{try{const n=JSON.parse(t);if(!n?.success)return void console.log(dotclear.debug&&n?.message?n.message:"Dotclear REST server error");if(n?.payload.ret){const{msg:t}=n.payload;if(void 0!==t&&t!==dotclear.dmPending.postsCounter){const o=e.getAttribute("href"),s=(o.includes("?")?"&":"?")+"status=-2",d=`${o}${s}`,c=document.querySelector(`#dashboard-main #icons p a[href="${d}"]`);if(c){const e=c.querySelector("span.db-icon-title-dm-pending");e&&(e.textContent=t)}else if(""!==t&&e.length){const n=` <a href="${d}"><span class="db-icon-title-dm-pending">${t}</span></a>`;e.insertAdjacentHTML("afterEnd",n)}const{nb:a}=n.payload;dotclear.badge(document.querySelector("#pending-posts"),{id:"dmpp",value:a,remove:a<=0,type:"soft"}),dotclear.dmPending.postsCounter=t}}}catch(e){console.log(e)}}),(e=>{console.log(e)}),!0,{json:1})},t=e=>{dotclear.services("dmPendingCommentsCount",(t=>{try{const n=JSON.parse(t);if(!n?.success)return void console.log(dotclear.debug&&n?.message?n.message:"Dotclear REST server error");if(n?.payload.ret){const{msg:t}=n.payload;if(void 0!==t&&t!==dotclear.dmPending.commentsCounter){const o=e.getAttribute("href"),s=(o.includes("?")?"&":"?")+"status=-1",d=`${o}${s}`,c=document.querySelector(`#dashboard-main #icons p a[href="${d}"]`);if(c){const e=c.querySelector("span.db-icon-title-dm-pending");e&&(e.textContent=t)}else if(""!==t){const n=` <a href="${d}"><span class="db-icon-title-dm-pending">${t}</span></a>`;e.insertAdjacentHTML("afterEnd",n)}const{nb:a}=n.payload;dotclear.badge(document.querySelector("#pending-comments"),{id:"dmpc",value:a,remove:a<=0,type:"soft"}),dotclear.dmPending.commentsCounter=t}}}catch(e){console.log(e)}}),(e=>{console.log(e)}),!0,{json:1})};dotclear.expandContent({lines:document.querySelectorAll("#pending-posts li.line"),callback:(e,t="toggle",n=null)=>{dotclear.dmViewPost(e,"dmppe",n.metaKey)}});for(const e of document.querySelectorAll("#pending-posts ul"))e.classList.add("expandable");dotclear.expandContent({lines:document.querySelectorAll("#pending-comments li.line"),callback:(e,t="toggle",n=null)=>{dotclear.dmViewComment(e,"dmpce",n.metaKey||e.classList.contains("sts-junk"))}});for(const e of document.querySelectorAll("#pending-comments ul"))e.classList.add("expandable");if(dotclear.dmPending.autoRefresh){if(dotclear.dmPending.postsCounter){let t=document.querySelector('#dashboard-main #icons p a[href="posts.php"]');t||(t=document.querySelector("#dashboard-main #icons p #icon-process-posts-fav")),t&&(e(t),dotclear.dmPending.postsTimer=setInterval(e,1e3*(dotclear.dmPending.interval||60),t))}if(dotclear.dmPending.commentsCounter){let e=document.querySelector('#dashboard-main #icons p a[href="comments.php"]');e||(e=document.querySelector("#dashboard-main #icons p #icon-process-comments-fav")),e&&(t(e),dotclear.dmPending.commentsTimer=setInterval(t,1e3*(dotclear.dmPending.interval||60),e))}}}));
