"use strict";dotclear.dmPendingPostsCount=e=>{dotclear.services("dmPendingPostsCount",(n=>{try{const t=JSON.parse(n);if(!t?.success)return void console.log(dotclear.debug&&t?.message?t.message:"Dotclear REST server error");if(t?.payload.ret){const{msg:n}=t.payload;if(void 0!==n&&n!=dotclear.dbPendingPostsCount_Counter){const o=e.attr("href"),s=(o.includes("?")?"&":"?")+"status=-1",d=`${o}${s}`;if($(`#dashboard-main #icons p a[href="${d}"]`).length){const t=e.children("span.db-icon-title-dm-pending");t.length&&t.text(n)}else if(""!=n&&e.length){const t=` <a href="${d}"><span class="db-icon-title-dm-pending">${n}</span></a>`;e.after(t)}const{nb:a}=t.payload;dotclear.badge($("#pending-posts"),{id:"dmpp",value:a,remove:0==a,type:"soft"}),dotclear.dbPendingPostsCount_Counter=n}}}catch(e){console.log(e)}}),(e=>{console.log(e)}),!0,{json:1})},dotclear.dmPendingPostsView=(e,n="toggle",t=null)=>{if(null==$(e).attr("id"))return;const o=$(e).attr("id").substr(4),s=`dmppe${o}`;let d=document.getElementById(s);d?($(d).toggle(),$(e).toggleClass("expand")):dotclear.getEntryContent(o,(n=>{if(n)return d=document.createElement("li"),d.id=s,d.className="expand",$(d).append(n),$(e).addClass("expand"),void e.parentNode.insertBefore(d,e.nextSibling);$(e).toggleClass("expand")}),{clean:t.metaKey,length:300})},dotclear.dmPendingCommentsCount=e=>{dotclear.services("dmPendingCommentsCount",(n=>{try{const t=JSON.parse(n);if(!t?.success)return void console.log(dotclear.debug&&t?.message?t.message:"Dotclear REST server error");if(t?.payload.ret){const{msg:n}=t.payload;if(void 0!==n&&n!=dotclear.dbPendingCommentsCount_Counter){const o=e.attr("href"),s=(o.includes("?")?"&":"?")+"status=-1",d=`${o}${s}`;if($(`#dashboard-main #icons p a[href="${d}"]`).length){const t=e.children("span.db-icon-title-dm-pending");t.length&&t.text(n)}else if(""!=n){const t=` <a href="${d}"><span class="db-icon-title-dm-pending">${n}</span></a>`;e.after(t)}const{nb:a}=t.payload;dotclear.badge($("#pending-comments"),{id:"dmpc",value:a,remove:0==a,type:"soft"}),dotclear.dbPendingCommentsCount_Counter=n}}}catch(e){console.log(e)}}),(e=>{console.log(e)}),!0,{json:1}),$.get("services.php",{f:"dmPendingCommentsCount",xd_check:dotclear.nonce}).done((e=>{$("rsp[status=failed]",e).length>0&&window.console.log("Dotclear REST server error")})).fail(((e,n,t)=>{window.console.log(`AJAX ${n} (status: ${e.status} ${t})`)})).always((()=>{}))},dotclear.dmPendingCommentsView=(e,n="toggle",t=null)=>{const o=$(e).attr("id").substr(4),s=`dmpce${o}`;let d=document.getElementById(s);const a=t.metaKey||$(e).hasClass("sts-junk");d?($(d).toggle(),$(e).toggleClass("expand")):dotclear.getCommentContent(o,(n=>{if(n)return d=document.createElement("li"),d.id=s,d.className="expand",$(d).append(n),$(e).addClass("expand"),void e.parentNode.insertBefore(d,e.nextSibling);$(e).removeClass("expand")}),{metadata:!1,clean:a})},$((()=>{if(Object.assign(dotclear,dotclear.getData("dm_pending")),$.expandContent({lines:$("#pending-posts li.line"),callback:dotclear.dmPendingPostsView}),$("#pending-posts ul").addClass("expandable"),dotclear.dmPendingPosts_Counter){let e=$('#dashboard-main #icons p a[href="posts.php"]');e.length||(e=$("#dashboard-main #icons p #icon-process-posts-fav")),e.length&&(dotclear.dmPendingPostsCount(e),dotclear.dbPendingPostsCount_Timer=setInterval(dotclear.dmPendingPostsCount,6e4,e))}if($.expandContent({lines:$("#pending-comments li.line"),callback:dotclear.dmPendingCommentsView}),$("#pending-comments ul").addClass("expandable"),!dotclear.dmPendingComments_Counter)return;let e=$('#dashboard-main #icons p a[href="comments.php"]');e.length||(e=$("#dashboard-main #icons p #icon-process-comments-fav")),e.length&&(dotclear.dmPendingCommentsCount(e),dotclear.dbPendingCommentsCount_Timer=setInterval(dotclear.dmPendingCommentsCount,6e4,e))}));
